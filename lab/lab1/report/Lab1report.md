<h1 align = "center">Lab1 QAM Modulation & Decode</h1>

<center>汪海玉 12011331 张旭东 12011923 </center>

# Introduction #

In this lab, what we aim to do is to analyze BER for PSK in AWGN channel on LabVIEW and achieve two kinds of basic QAM which are 16QAM and 64QAM.After that, we recorded the BER with different SNR. It is obvious that the BER would decrease with SNR  increasing. To prove the conclusion, we use USRP to simulate the program. However, theoretical knowledge of QAM should be known before the experiment. The following is the brief introduction of it.
## Principle of QAM ##
QAM means Quadrature Amplitude Modulation,QAM utilises both amplitude and phase components to provide a form of modulation that is able to provide high levels of spectrum usage efficiency.

### QAM modulation

The full modulation flow is shown as below:
<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20220924171821487.png" alt="image-20220924171821487" style="zoom:50%;" />

1. First do symbol mapping for transmitted bits to get $s[n]$ 
2. Then  do upper-sampling to get $g[n]$
3. After that, use a sampling signal with T=T~s~ to convert digital signal to analog signal.
4. At last, normalize the energy of signal. 

### Constellation and Symbol Mapping

The constellation and symbol mapping of BPSK(2QAM), 4QAM, 14QAM and 64QAM is shown as following:

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20220924173759883.png" alt="image-20220924173759883" style="zoom:33%;" />



<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20220924173829655.png" alt="image-20220924173829655" style="zoom:33%;" />



<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20220924173903501.png" alt="image-20220924173903501" style="zoom:33%;" />



<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20220924174053191.png" alt="image-20220924174053191" style="zoom:33%;" />

### QAM Demodulation

The full demodulation flow is shown as below:

![](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/chart2.svg)

1. First we should use a sampling signal with T=T~s~ to convert the analog signal to digital.
2. Perform the under-sampling to obtain y[n].
3. Locate the input symbols.
4. convert the symbols to corresponding bit according to the inverse symbol map.

In simulation, we simplify the process. We only need to deal with the y[n] after under-sampling. And the process will be  illustrated in the following report.

### Maximum-likelihood Receiver

After getting $y[n]$, what is needed to do is detection and inverse symbol mapping.  The method which is used to do detection and inverse symbol mapping is called $Maximum-likelihood Receiver$. The principle of it is shown as following.

Suppose we are under gauss channel, and every symbol appears in the same possibility. We can get the following equation.
$$
\begin{align*}
\widehat{m}&=\mathrm{arg}\max_{1\leqslant m\leqslant M} \left[ \frac{N_0}{2}\ln P_{\mathrm{m}}-\frac{1}{2}\left\| \boldsymbol{r}-s_{\mathrm{m}} \right\| \right] 
\\
&=\mathrm{arg}\max_{1\leqslant m\leqslant M} \left[ -\left\| \boldsymbol{r}-s_{\mathrm{m}} \right\| ^2 \right] 
\\
&=\mathrm{arg}\min_{1\leqslant m\leqslant M} \left\| \boldsymbol{r}-s_{\mathrm{m}} \right\|
\end{align*}
$$
It turns out that if we want to maximize the probability of recovering the correct symbol we need to minimize $ \left\| \boldsymbol{r}-s_{\mathrm{m}} \right\|$. And in the complex plane, it corresponds the Euclidean distance.

The following constellation map can show the process more intuitionistic.

![image-20220914203321716](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220914203321716.png)

We can find that $d_1<d_2<d_4<d_3$, so the decode result should be $00$.

### Bit-error Rate

The formulate of calculating  bit-error rate is:
$$
p_{error}=\frac{bit_{different}}{bit_{total}}
$$
 where $bit_{different}$  means the amount of different bits, $bit_{total}$ means the amount of transmitted bits.

# Result and Analysis

## 16/64-QAM Modulation

### program diagram

The program diagram of 16QAM and 64 QAM is shown as following.

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20220924181315731.png" alt="image-20220924181315731" style="zoom:33%;" />

​                                                    <img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20220924181508498.png" alt="image-20220924181508498" style="zoom:33%;" />

For the transmitted bits, the first thing is to multiply every bit with its corresponding weight and sum them to get a decimal digit. Then  let the decimal digit correspond to the symbol map which is generated by `MT Generate System Parameters.vi`. 

There is one thing to be considered. For 64QAM, we need to set `samples per symbol` and `M-QAM` to `64` because the default value of them isn't 64.

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20220924182813764.png" alt="image-20220924182813764" style="zoom: 67%;" />

### Result

The result of 16QAM and 64QAM modulation is shown as below:

- 16QAM<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20220924183557250.png" alt="image-20220924183557250" style="zoom:50%;" />

- 64QAM 

  <img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20220924183723454.png" alt="image-20220924183723454" style="zoom:50%;" />

  

## 16/64-QAM Modulation

### program diagram

Inspired by the given QPSK demodulation process, to demodulate 16QAM and 64QAM we just need to give the right symbol map, find the minimal distance and convert it into the right bit stream.

![image-20220914194426370](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220914194426370.png)

The symbol map is generated in the `MT Generate System Parameters.vi`. So the program diagram of 16QAM and 64QAM are shown as below:

![image-20220914203954676](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220914203954676.png)



![image-20220914204013147](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220914204013147.png)

There are two things deserve our attention:

1. We need normalize the power of each symbol just as our mapping rule, or there will be a scale in inverse map and may course some problems.
2. We need to set `samples per symbol` and `M_QAM` to `64` of the `MT Generate QAM System Parameters(M)` in the 64QAM, so that it can generate the right symbol map of 64QAM. We can ignore this step in 16QAM, that is because the default value of this module is 16.

![image-20220914205714733](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220914205714733.png)

### Result

The result of 16QAM and 64QAM  demodulation are shown as below:

+ 16QAM:

![image-20220914205812469](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220914205812469.png)

![image-20220914205842938](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220914205842938.png)

![image-20220914205907872](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220914205907872.png)

64QAM:

![image-20220914210001611](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220914210001611.png)

![image-20220914210059084](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220914210059084.png)

![image-20220914210118894](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220914210118894.png)

1. We can deduce from the `received constellation` and `average bit-error rate (ABER)` that:

   1. As `noise power` increases, so will `BER.`
   2. The `noise power` has a threshold value below which the `ABER` is zero.
   3. The threshold value varies depending on the modulation. The value for 16QAM is around -10dB, and for 64QAM it is around -20dB.

## `BER` under different `SNR` conditions

To find the relationship between different modulation and the threshold and compare the performance between different modulation. We draw the `SNR-BER` of different modulation in one graph. 

To save the page, I will just introduce the how to draw curve of 64QAM, the same goes for the rest.

The program diagram is shown as below:

![image-20220924170958018](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220924170958018.png)

I control the generation of `SNR` with a `for-loop` and save the value in an array before inserting it into the `AWGN` subvi. I can get the `BER` under the current `SNR` after decoding. We can now use a `shift-register` and another array to store the entire result. After calculating the result, we can `bundle` it and plot it in a graph. If we copy the program and change the attributes, we will get a different curve. The end result is as follows:

1. ![image-20220924164837750](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220924164837750.png)

Since the step length is 0.1dB and a little bit change in BER will vary a lot in log scale, so the end of the curve oscillates violently. It will be more smooth if we change the step length to 1dB

![image-20220924172439582](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/image-20220924172439582.png)

We can find it here:

1. As SNR increases, BER will decrease.
2. BPSK has the highest noise resistance, followed by QPSK, 16QAM, and 64QAM.

## USRP Verification

To simulate the real environment, we simulate the program in USRP. The result is shown as following.

- 16QAM![16QAM tx星座图](D:\Study in SUSTech\First semester of junior year\wireless communication\lab\lab1\report\16QAM tx星座图.JPG)

  ![16QAMtx 眼图](D:\Study in SUSTech\First semester of junior year\wireless communication\lab\lab1\report\16QAMtx 眼图.JPG)

  ![16QAM RX 星座图](D:\Study in SUSTech\First semester of junior year\wireless communication\lab\lab1\report\16QAM RX 星座图.png)

  ![16QAM RX 眼图](D:\Study in SUSTech\First semester of junior year\wireless communication\lab\lab1\report\16QAM RX 眼图.png)

- 64QAM

  ![64QAMtx](D:\Study in SUSTech\First semester of junior year\wireless communication\lab\lab1\report\64QAMtx.png)

  ![64QAMrx](D:\Study in SUSTech\First semester of junior year\wireless communication\lab\lab1\report\64QAMrx.png)

  

# Experience

## In class submission

汪海玉：

Week1:

![](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/1.png)

![2](https://smangic-markdown-image.oss-cn-shenzhen.aliyuncs.com/img/2.png)

Week2:

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20220924185832443.png" alt="image-20220924185832443" style="zoom:50%;" />

<img src="C:\Users\胡晨\AppData\Roaming\Typora\typora-user-images\image-20220924185855448.png" alt="image-20220924185855448" style="zoom: 33%;" />

张旭东：

Week1:

<img src="D:\Study in SUSTech\First semester of junior year\wireless communication\lab\lab1\report\submission(week1).JPG" alt="submission(week1)" style="zoom:33%;" />

week2:

<img src="D:\Study in SUSTech\First semester of junior year\wireless communication\lab\lab1\report\submission(week2).JPG" alt="submission(week2)" style="zoom:33%;" />

## Learning:

1. We discovered how Quadrature amplitude modulation (QAM) works.

2. We learnt the function of symbol map.

3. We discovered the performance differences between various modulations.

   

## Contribution:

汪海玉：

- QAM Demodulation
- Maximum-likelihood Receiver
- `BER` under different `SNR` conditions
- Report writing

张旭东：

- QAM modulation
- Constellation and Symbol Mapping
- USRP Verification
- Report writing





| Score                               100 |      |
| :-------------------------------------: | ---- |

